# 04 노드의 기본 기능 알아보기

## 04-1 주소 문자열과 요청 파라미터 다루기

웹 사이트에 접속하기 위한 사이트 주소 정보는 노드에서 **URL 객체**로 만들 수 있음

**url 모듈** 

- 주소 문자열은 단순 문자열이므로 사이트 주소와 요청 마라미터를 구별하기 위해 노드에 미리 만들어 둔 모듈 -> 일반 주소 문자열을 URL 객체로 만들거나 URL 객체에서 일반 문자열로 변환하는 일이 쉬워짐
- 문자열 안에 있던 각각의 정보가 객체의 속성으로 보관이 되어 프로토콜 또는 요청 피라미터를 확인하려면 url 객체가 갖고 있는 속성값을 확인하면 됨

### 1. 주소 문자열을 URL 객체로 변환하기

**url 모듈의 주요 메소드**

- parse() : 주소 문자열을 파싱하여 URL 객체를 만들어 준다.
- format() : URL 객체를 주소 문자열로 변환한다.

### 2. 요청 파라미터 확인하기

URL 객체의 속성을 보면 주소 문자열의 여러 가지 정보가 포함되어 있다.

그중 **query 속성**은 요청 파라미터 정보를 가지고 있는데 웹 서버에서는 클라이언트에서 요청한 요청 파라미터를 받아 처리할 때가 많으므로 이 속성에 있는 문자열을 다시 각각의 요청 파라미터로 분리해야 한다.

**querystring 모듈** : 요청 파라미터는 & 기호로 분리되는데 요청 파라미터를 쉽게 분리할 수 있는 모듈

**querystring 모듈의 주요 메소드**

- parse() : 요청 파라미터를 파싱여 요청 파라미터 객체로 만들어 준다.
- stringify() : 요청 파라미터 객체를 문자열로 변환한다.

## 04-2 이벤트 이해하기

노드는 대부분 이벤트를 기반으로 하는 비동식 방식으로 처리 -> 처리하기 위해 서로 이벤트를 전달한다.

이벤트는 한쪽에서 다른 쪽으로 알림 메시지를 보내는 것과 비슷하다

-> 지금 이쪽의 상태는 이렇다는 정보를 다른 쪽으로 보내는 것이다

**EventEmitter** : 이벤트를 보내고 받을 수 있도록 만들어 둔 곳

이벤트는 한 쪽에서 다른 쪽으로 어떤 일이 발생했음을 알려주는 것으로 다른 쪽에서 이벤트를 받고 싶다면 이벤트 리스너(Event Listener)를 등록할 수 있다.

### 1. 이벤트 보내고 받기

노드의 객체는 **EventEmitter**를 상속받을 수 있으며 그 후 EventEmitter 객체의 **on()**과 **emit()** 메소드를 사용할 수 있음

**이벤트를 처리하는 EventEmitter의 주요 메소드**

- on(event, listener) : 지정한 이벤트의 리스너를 추가
- once(event, listener) : 지정한 이벤트의 리스너를 추가하지만 한 번 실행한 후에는 자동으로 리스너 제거
- removeListener(event, listener) : 지정한 이벤트에 대한 리스너를 제거

**emit()으로 보내고 on()으로 받는다**

### 04-3 파일 다루기

- 동기식 IO : 파일 작업이 끝날 때까지 대기하며 Sync라는 단어를 붙인다. 속도에 영향이 끼칠 수 있음
- 비동기식 IO : 파일 작업을 요청만 하고 그 다음 작업을 수행한다. 이후 파일 작업이 끈나면 그 상태는 이벤트로 받아서 처리한다.

#### 1. 파일 읽어 들이거나 파일에 쓰기

**파일을 읽고 쓰는 대표적인 네 가지 메소드**

- readFile(filename, [encoding], [callback]) : 비동기식 IO로 파일을 읽어들임
- readFileSync(filename, [encoding]) : 동기식 IO로 파일을 읽어들임
- writeFile(filename, data, encoding = 'utf8', [callback]) : 비동기식 IO로 파일을 씀
- writeFileSync(filename, data, encoding = 'utf8') : 동기식 IO로 파일을 씀

대부분은 비동기식 방식의 메소드를 주로 이용

#### 2. 파일을 직접 열고 닫으면서 읽거나 쓰기

**파일을 직접 열고 닫으면서 일부분만 읽거나 쓰기 위한 메소드**

- open(path, flags, [mode], [callback]) : 파일을 염
- read(fd, buffer, offset, length, position, [callback]) : 지정한 부분의 파일 내용을 읽어들임
- write(fd, buffer, offset, length, position, [callback]) : 파일의 지정한 부분에 데이터를 씀
- close(fd, [callback]) : 파일을 닫아줌

**파일을 열 때 사용하는 대표적인 플래그**

- r : 읽기에 사용하는 플래그, 파일이 없으면 예외 발생
- w : 쓰기에 사용하는 플래그, 파일이 없으면 만들어지고 있으면 이전 내용을 모두 삭제
- w+ : 읽기와 쓰기에 모두 사용하는 플래그, 파일이 없으면 만들어지고 있으면 이전 내용을 모두 삭제
- a+ : 읽기와 추가에 모두 사용하는 플래그, 파일이 없으면 만들어지고 있으면 이전 내용에 새로운 내용 추가

#### 3. 스트림 단위로 파일 읽고 쓰기

**파일을 스트림 단위로 처리하는 대표적인 메소드**

- createReadStream(path, [options]) : 파일을 읽기 위한 스트림 객체 만들기
- createWriteStream(path, [options]) : 파일을 쓰기 위한 스트림 객체 만들기

옵션으로는 flags, encoding, autoClose 속성이 들어 있는 자바스크립트 객체를 전달할 수 있다.

**pipe() 메소드**는 두 개의 스트림을 붙여주는 역할을 한다

-> ReadStream 타입의 객체와 WriteStream 타입의 객체를 붙여주면 스트림 간에 데이터를 알아서 전달한다.

### 04-4 로그 파일 남기기

console 객체의 log() 또는 error() 메소드 등을 호출하면 로그를 출력할 수 있다.

but 프로그램의 크기가 커지면 로그 양이 많아지고 보관했다가 나중에 확인해야하는 경우도 생기기에 다양한 방식으로 로그를 남길 수 있도록 외부 모듈 사용 (여기서는 로그 모듈 중 **winston 모듈** 사용, moment)

winston 모듈로 만드는 **로거(Logger, 로그를 출력하는 객체를 말할 때 사용하는 용어)**는 transports라는 속성 값으로 여러 개의 설정 정보를 전달할 수 있다.

**로그 수준** : 어떤 정보까지 출력할 것인지 결정하는 것, 하위 수준은 상위 수준을 포함

- debug : 0 > info: 1 > notice: 2 > warning: 3 > error: 4 > crit: 5 > alert: 6 > emerg: 7 



